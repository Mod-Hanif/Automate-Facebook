name: Facebook Page Automator

on:
  workflow_dispatch:
    inputs:
      username:
        description: "[Optional] The Facebook username to log in as."

      page_url:
        description: "[Required] The URL of the Facebook page where you want to like all posts and add comments."
        required: true

      groups:
        description: "[Optional] The names of the groups where you want to share the post, separated by commas."

      share_count:
        description: "[Optional] The number of times to share the post in the specified groups. Default is 5."
        default: "5"

      comment_count:
        description: "[Optional] The number of comments to write. Default is 50."
        default: "50"

      like_count:
        description: "[Optional] The number of posts you want to like on the specified Facebook page. Default is 50."
        default: "50"

  schedule:
    - cron: "0 */6 * * *" # Runs at 0 minutes past the hour, every 6 hours.

jobs:
  main:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v2

      - name: Install Tor and Proxychains4 for Anonymized Requests
        run: |
          sudo apt-get update
          sudo apt-get install -y tor proxychains4

      - name: Configure Tor with Control Port and Password
        run: |
          echo "ControlPort 9051" | sudo tee -a /etc/tor/torrc
          echo "HashedControlPassword 16:F6619F3AC6F73A1C603AF765CD9850B6D0FC6F0E2E56FA0A32A255B191" | sudo tee -a /etc/tor/torrc
          echo "CookieAuthentication 0" | sudo tee -a /etc/tor/torrc

      - name: Start Tor Service
        run: sudo service tor start

      - name: Set Up Python Environment
        uses: actions/setup-python@v4
        with:
          python-version: "3.12"

      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Start Virtual Framebuffer for Headless Chrome
        run: |
          Xvfb :99 -ac &
          export DISPLAY=:99

      - name: Execute Facebook Bot on Scheduled Run
        if: startsWith(github.event.schedule, '0 */6')
        run: python start.py

      - name: Execute Facebook Bot for Manual Trigger
        if: ${{ github.event_name == 'workflow_dispatch' }}
        run: |
          python facebook.py \
            --headless \
            --disable-gpu \
            --disable-infobars \
            --disable-extensions \
            --start-maximized \
            --block-notifications \
            --no-sandbox \
            main \
            --page-url "${{ github.event.inputs.page_url}}" \
            --username "${{ github.event.inputs.username }}" \
            --groups "${{ github.event.inputs.groups}}" \
            --share-count "${{ github.event.inputs.share_count}}" \
            --comment-count "${{ github.event.inputs.comment_count}}" \
            --like-count "${{ github.event.inputs.like_count}}"
